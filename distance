from opencage.geocoder import OpenCageGeocode
from math import radians, cos, sin, asin, sqrt

def find_distance(d,r):
    key = '2d443c2a87a645b58686ba1d3c80593d'
    geocoder = OpenCageGeocode(key)

    donor_result = geocoder.geocode(d)
    lat_d = donor_result[0]['geometry']['lat']
    lon_d = donor_result[0]['geometry']['lng']

    requester_result = geocoder.geocode(r)
    lat_r = requester_result[0]['geometry']['lat']
    lon_r = requester_result[0]['geometry']['lng']

    return haversine(lon_d, lat_d, lon_r, lat_r)

def haversine(lon1, lat1, lon2, lat2):
    # convert decimal degrees to radians
    lon1, lat1, lon2, lat2 = map(radians, [lon1, lat1, lon2, lat2])

    # haversine formula
    dlon = lon2 - lon1
    dlat = lat2 - lat1
    a = sin(dlat/2)**2 + cos(lat1) * cos(lat2) * sin(dlon/2)**2
    c = 2 * asin(sqrt(a))
    r = 3956
    result = c * r

    return priority_calc(result)

def priority_calc(result):
    if result <= 50:
        return 0
    else:
        return result
        
 #compare the two numbers
 #if they are the same (aka both 0 or same distance) then move to date needed by
 #if one is lower than the other, lower gets priority


print(find_distance('111 Main St, Basking Ridge, NJ','Jersey City, NJ'))


